{
  "description": "Walnut 1.0 — System hooks for session lifecycle, log protection, archive enforcement, and stash preservation.",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "bash ${CLAUDE_PLUGIN_ROOT}/scripts/session-start.sh",
            "timeout": 10
          }
        ]
      }
    ],

    "PreToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "LOG GUARDIAN: You are about to edit a file. If the target file is named 'log.md', check: is this edit modifying content within an existing signed entry (a block between '## [datetime] — squirrel:[id]' and 'signed: squirrel:[id]')? If yes, DENY — log.md entries are immutable once signed. Say: 'log.md is immutable. That entry is signed — add a correction entry instead.' If the edit is prepending NEW content right after the YAML frontmatter, or updating YAML frontmatter fields (last-entry, entry-count, summary), ALLOW. If the file is not log.md, ALLOW immediately."
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "ARCHIVE ENFORCER: You are about to run a bash command. If the command contains 'rm ', 'rm -rf', 'rm -r', 'rmdir', 'unlink', or any file/directory deletion pattern, AND the target path is inside an ALIVE World (contains 01_Archive/, 02_Life/, 03_Inputs/, 04_Ventures/, 05_Experiments/, _squirrels/, _scratch/, _chapters/, or _references/), DENY. Say: 'Nothing gets deleted in ALIVE. Archive it instead — move to 01_Archive/[original-path]. Want me to archive it?' If the deletion target is outside the ALIVE World, ALLOW. If the command is not a deletion, ALLOW immediately."
          }
        ]
      }
    ],

    "PreCompact": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "COMPACTION SAVE: Context is about to be compacted. Your stash — all decisions, tasks, and notes you've been carrying in conversation — will be lost. Before compaction proceeds: write your current stash to the squirrel entry file (_squirrels/squirrel:[your-id].yaml) under the 'stash:' field. Also note any scratch files you've been working on. This is not a close — the session continues. But your conversational memory won't survive compaction. The squirrel entry is the only thing that persists."
          }
        ]
      }
    ]
  }
}
