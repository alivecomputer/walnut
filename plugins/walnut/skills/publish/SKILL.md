---
description: Context out. Publish to your walnut.world, share via token links. Everything keyphrase-protected by default.
user-invocable: true
triggers:
  # Direct
  - "walnut:publish"
  - "publish"
  - "publish this"
  # Ship
  - "ship it"
  - "ship this"
  - "make this live"
  - "put this on my site"
  - "push this"
  # View
  - "let me see this on my phone"
  - "preview this"
  - "how does this look"
  # Share
  - "share this"
  - "send this to someone"
  - "make a link"
  - "give me a shareable link"
  - "I want to send this to"
  # Gallery
  - "show me what I've published"
  - "my published stuff"
  - "my gallery"
  - "what's live"
---

# Publish

Context out. Everything published is keyphrase-protected by default. Your content, your keyphrase, your wall.

---

## Mode Selection

When the conductor invokes publish, determine the mode:

â†’ AskUserQuestion: "What do you want to do?"
- **Publish** â€” "Render and push to my walnut.world. Keyphrase protected. Added to my gallery."
- **Share** â€” "Generate a token link for something already published. Anyone with the link can view it."

## Two Modes

### Publish (content â†’ walnut.world)

Everything published is keyphrase-protected automatically. The API applies the conductor's keyphrase as the default password on every publish. No public content. No opt-out.

1. Read the file (from `_core/_working/`, live context, or any path)
2. Render markdown â†’ clean HTML with default viewer
3. Call `POST /api/link/publish` with name, keyphrase, and files
4. API auto-applies:
   - Keyphrase as default password
   - `indexable: false`
   - `noCrawl: true`
   - `noFollow: true`
5. Content added to gallery index at `user.walnut.world`
6. Log entry: "Published [name] to [url]"

```
â•­â”€ ğŸ¿ï¸ published
â”‚  nova-station.walnut.world/orbital-safety-brief
â”‚  Keyphrase protected. Added to your gallery.
â”‚  Share with a token link?
â•°â”€
```

The conductor views it by going to the URL and entering their keyphrase. Same keyphrase they set when they claimed their walnut.world link.

### Share (token link for one published item)

For sending a specific piece to another person without giving them the keyphrase.

1. Pick a published item (from gallery or by slug)
2. Generate a token (random string stored in KV)
3. Token link: `user.walnut.world/slug?token=k9x2m4`
4. Token bypasses keyphrase for that one item only
5. Not indexed, not crawlable
6. Revocable â€” conductor can kill the token anytime
7. Log entry: "Shared [name] via token link"

```
â•­â”€ ğŸ¿ï¸ share link generated
â”‚  nova-station.walnut.world/orbital-safety-brief?token=k9x2m4
â”‚  Anyone with this link can view it. Revoke anytime.
â•°â”€
```

---

## Gallery

`user.walnut.world` â€” the conductor's personal gallery. Auto-generated on each publish. Keyphrase protected like everything else.

Shows:
- Title / slug
- When published
- Source walnut (if known)

The gallery is regenerated by the publish API on every publish call. It reads the published items from KV and renders a static index.

---

## API Contract (walnut.world)

**Publish:**
```
POST https://walnut.world/api/link/publish
Body:
  {
    "name": "nova-station",
    "keyphrase": "your-keyphrase",
    "files": [
      {
        "path": "orbital-brief/index.html",
        "content": "<html>...</html>",
        "contentType": "text/html"
      }
    ]
  }
Response:
  { "ok": true, "url": "https://nova-station.walnut.world/orbital-brief", "files": 1 }
```

The API auto-applies keyphrase protection. The conductor does NOT need to pass access config â€” it's automatic.

**Unpublish:**
```
POST https://walnut.world/api/link/unpublish
Body: { "name": "nova-station", "keyphrase": "...", "path": "orbital-brief/" }
```

**Claim a name:**
```
POST https://walnut.world/api/name/reserve
Body: { "name": "nova-station", "keyphrase": "your-keyphrase" }
```

---

## Keyphrase Auth

Two env vars in `.env.local`:
- `WALNUT_NAME` â€” your claimed name (e.g., "nova-station")
- `WALNUT_KEYPHRASE` â€” set when you claimed it

If neither is set, the squirrel offers to claim:

```
â•­â”€ ğŸ¿ï¸ no walnut.world link found.
â”‚  Claim yours at walnut.world to start publishing.
â”‚  What name do you want? (e.g., nova-station.walnut.world)
â•°â”€
```

---

## What the Squirrel Does on Publish

1. Render content to HTML
2. Call the API
3. Confirm URL to conductor
4. **Write a log entry** â€” "Published [name] to [url]" with timestamp
5. **Update key.md** `published:` field if it exists
6. Offer to share via token link

---

## What's NOT Public

Nothing. Ever. Every file, every asset, every page â€” keyphrase protected by default. The conductor explicitly creates share tokens for specific items they want others to see. Everything else requires the keyphrase.
